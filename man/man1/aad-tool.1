.TH AAD-TOOL "1" "2025-06-27" "aad-tool" "User Commands"
.SH NAME
aad-tool \- Azure Entra ID (AAD) management utility for Himmelblau
.SH SYNOPSIS
.B aad-tool
\fI<COMMAND>\fR [OPTIONS]
.SH DESCRIPTION
The `aad-tool` utility is part of the Himmelblau project, designed to manage and interact with Azure Entra ID through various commands. It allows you to test authentication, manage caches, and check the status of services related to the `himmelblaud` resolver.
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SYNOPSIS
.B aad-tool \fI\,<COMMAND>\/\fR
.SH DESCRIPTION
Himmelblau Management Utility
.SS "Commands:"
.TP
application
Manage Entra ID application registrations, including creation, listing, and extension schema configuration
.TP
auth\-test
Test authentication of a user via the himmelblaud resolver "pam" channel. This does not test that your pam configuration is correct \- only that himmelblaud is correctly processing and validating authentications
.TP
cache\-clear
Erase the content of the himmelblaud resolver cache. You should probably use `invalidate` instead
.TP
cache\-invalidate
Invalidate, but don't erase the content of the himmelblaud resolver cache. This will force the himmelblaud daemon to refresh all user and group content immediately. If the connection is offline, entries will still be available and will be refreshed as soon as the daemon is online again
.TP
configure\-pam
Configure PAM to use pam_himmelblau
.TP
enumerate
Enumerate all users and groups in Entra ID that have `rfc2307` attributes, and cache their values locally. This addresses the issue where UID/GID mappings are needed before authentication can succeed, but are normally only retrievable after login
.TP
user
Manage Entra ID user accounts, including POSIX attribute assignment and UID mapping
.TP
group
Manage Entra ID groups, including POSIX attribute assignment and GID mapping
.TP
idmap
Manage the static idmapping cache used to map Entra ID accounts to static UID/GID values. This is useful for migrations from on\-prem AD to Entra ID, where existing UID/GID mappings need to be preserved
.TP
status
Check that the himmelblaud daemon is online and able to connect correctly to the himmelblaud server
.TP
version
Show the version of this tool
.TP
help
Print this message or the help of the given subcommand(s)
.SH OPTIONS
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,application add-schema-extensions \/\fR[\fI\,OPTIONS\/\fR] \fI\,--client-id <CLIENT_ID> --schema-app-object-id <SCHEMA_APP_OBJECT_ID>\/\fR
.SS DESCRIPTION
Adds a standard set of POSIX\-related schema extensions to an existing Entra ID application.
.PP
This command registers directory extension attributes (e.g., `uidNumber`, `gidNumber`, `unixHomeDirectory`, `loginShell`, `gecos`) on the application specified by `\-\-schema\-app\-object\-id`. These extensions will be usable on user and/or group objects, as appropriate.
.PP
The application specified by `\-\-schema\-app\-object\-id` must already exist in the tenant, and must be identified by its Object ID (not the Client ID). This value is labeled as "Object ID" in the Entra Admin Center and corresponds to the `id` field in Graph API responses.
.PP
You must also supply a separate `\-\-client\-id` that grants `Application.ReadWrite.All` permissions to perform the extension registration.
.PP
If the `\-\-name` parameter is omitted, the command authenticates as the currently logged\-in user via the Himmelblau SSO broker. If the `\-\-name` parameter is provided, the command attempts to authenticate as the specified Entra ID user. In this case, the command must be run as `root` to impersonate another user.
.PP
This command must be run from a device that has already been joined to Entra ID.
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-\-client\-id\fR <CLIENT_ID>
.HP
\fB\-\-schema\-app\-object\-id\fR <SCHEMA_APP_OBJECT_ID>
.HP
\fB\-h\fR, \fB\-\-help\fR
.IP
Print help (see a summary with '\-h')
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,application create \/\fR[\fI\,OPTIONS\/\fR] \fI\,--client-id <CLIENT_ID> --display-name <DISPLAY_NAME>\/\fR
.SS DESCRIPTION
Creates a new Entra ID application registration in the current tenant.
.PP
This command performs a delegated Microsoft Graph API request using an access token acquired via the specified client application (`\-\-client\-id`), which must have `Application.ReadWrite.All` permissions in the tenant.
.PP
The new application will be created with the provided `\-\-display\-name`.
.PP
You may specify one or more `\-\-redirect\-uri` options to configure redirect URIs for the application (used for public client authentication). If no redirect URIs are provided, the application will not include any by default.
.PP
Use the `\-\-user\-read\-write` and/or `\-\-group\-read\-write` flags to grant the application additional Microsoft Graph API permissions at registration time, including `User.ReadWrite.All` and `Group.ReadWrite.All`.
.PP
NOTE: If you grant these permissions, it is strongly recommended that you restrict access to the application to specific administrators or groups:
.PP
1. In the Microsoft Entra admin portal, go to Entra???ID \-> Enterprise applications and find your app's entry. 2. Under Properties, set "Assignment required?" to Yes. 3. Go to Users and groups, click Add, and assign only the specific users or groups you want to have access.
.PP
If the `\-\-name` parameter is omitted, the command authenticates as the currently logged\-in user via the Himmelblau SSO broker. If the `\-\-name` parameter is provided, the command attempts to authenticate as the specified Entra ID user. In this case, the command must be run as `root` to impersonate another user.
.PP
This command must be run from a device that has already been joined to Entra ID.
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-\-client\-id\fR <CLIENT_ID>
.HP
\fB\-\-display\-name\fR <DISPLAY_NAME>
.HP
\fB\-\-redirect\-uri\fR <URI>
.HP
\fB\-\-user\-read\-write\fR
.HP
\fB\-\-group\-read\-write\fR
.HP
\fB\-h\fR, \fB\-\-help\fR
.IP
Print help (see a summary with '\-h')
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,application list-schema-extensions \/\fR[\fI\,OPTIONS\/\fR] \fI\,--client-id <CLIENT_ID> --schema-app-object-id <SCHEMA_APP_OBJECT_ID>\/\fR
.SS DESCRIPTION
Lists the schema extension attributes registered on an Entra ID application.
.PP
This command retrieves the directory extension attributes (e.g., `uidNumber`, `gidNumber`, etc.) that have been added to the application identified by `\-\-schema\-app\-object\-id`.
.PP
The `\-\-schema\-app\-object\-id` parameter must be the Object ID of the application (not the Client ID), as shown in the Entra Admin Center. This value corresponds to the `id` field in Microsoft Graph and is required to query extension properties.
.PP
You must also supply a separate `\-\-client\-id` that grants `Application.Read.All` or `Application.ReadWrite.All` permissions in the tenant to perform this query.
.PP
If the `\-\-name` parameter is omitted, the command authenticates as the currently logged\-in user via the Himmelblau SSO broker. If the `\-\-name` parameter is provided, the command attempts to authenticate as the specified Entra ID user. In this case, the command must be run as `root` to impersonate another user.
.PP
This command must be run from a device that has already been joined to Entra ID.
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-\-client\-id\fR <CLIENT_ID>
.HP
\fB\-\-schema\-app\-object\-id\fR <SCHEMA_APP_OBJECT_ID>
.HP
\fB\-h\fR, \fB\-\-help\fR
.IP
Print help (see a summary with '\-h')
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,application list \/\fR[\fI\,OPTIONS\/\fR] \fI\,--client-id <CLIENT_ID>\/\fR
.SS DESCRIPTION
Lists Entra ID application registrations in the current tenant.
.PP
This command performs a delegated Microsoft Graph API request using an access token acquired via the specified client application (`\-\-client\-id`), which must have `Application.Read.All` permissions in the tenant.
.PP
If the `\-\-name` parameter is omitted, the command authenticates as the currently logged\-in user via the Himmelblau SSO broker. If the `\-\-name` parameter is provided, the command attempts to authenticate as the specified Entra ID user. In this case, the command must be run as `root` to impersonate another user.
.PP
This command must be run from a device that has already been joined to Entra ID.
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-\-client\-id\fR <CLIENT_ID>
.HP
\fB\-h\fR, \fB\-\-help\fR
.IP
Print help (see a summary with '\-h')
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,auth-test \/\fR[\fI\,OPTIONS\/\fR] \fI\,--name <ACCOUNT_ID>\/\fR
.SS DESCRIPTION
Test authentication of a user via the himmelblaud resolver "pam" channel. This does not test that your pam configuration is correct \- only that himmelblaud is correctly processing and validating authentications
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,cache-clear \/\fR[\fI\,OPTIONS\/\fR]
.SS DESCRIPTION
Erase the content of the himmelblaud resolver cache. You should probably use `invalidate` instead
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-\-really\fR
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,cache-invalidate \/\fR[\fI\,OPTIONS\/\fR]
.SS DESCRIPTION
Invalidate, but don't erase the content of the himmelblaud resolver cache. This will force the himmelblaud daemon to refresh all user and group content immediately. If the connection is offline, entries will still be available and will be refreshed as soon as the daemon is online again
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,configure-pam \/\fR[\fI\,OPTIONS\/\fR]
.SS DESCRIPTION
Configure PAM to use pam_himmelblau
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-\-really\fR
.HP
\fB\-\-auth\-file\fR <AUTH_FILE>
.HP
\fB\-\-account\-file\fR <ACCOUNT_FILE>
.HP
\fB\-\-session\-file\fR <SESSION_FILE>
.HP
\fB\-\-password\-file\fR <PASSWORD_FILE>
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,enumerate \/\fR[\fI\,OPTIONS\/\fR] \fI\,--name <ACCOUNT_ID> --client-id <CLIENT_ID>\/\fR
.SS DESCRIPTION
Enumerate all users and groups in Entra ID that have `rfc2307` attributes, and cache their values locally. This addresses the issue where UID/GID mappings are needed before authentication can succeed, but are normally only retrievable after login.
.PP
The `\-\-client\-id` parameter is required and must refer to a registered Entra ID application with `User.Read.All` permissions.
.PP
The `\-\-name` parameter specifies the Entra ID user on whose behalf the token is requested, enabling delegated access through the specified client application.
.PP
This command can only be executed from an Entra Id enrolled host.
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-\-client\-id\fR <CLIENT_ID>
.HP
\fB\-h\fR, \fB\-\-help\fR
.IP
Print help (see a summary with '\-h')
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,group set-posix-attrs \/\fR[\fI\,OPTIONS\/\fR] \fI\,--schema-client-id <SCHEMA_CLIENT_ID> --group-id <GROUP_ID> --gid <GID>\/\fR
.SS DESCRIPTION
Sets POSIX\-related attributes on a specified Entra ID group object.
.PP
This command updates the `gidNumber` attribute on the Entra ID group identified by `\-\-group\-id`, which must be a valid Object ID.
.PP
You must also provide the `\-\-schema\-client\-id`, which identifies the application where the extension properties were registered. This value must be the Client ID of the application used for schema registration. The application associated with `\-\-schema\-client\-id` must supply `Group.ReadWrite.All` permissions in the tenant.
.PP
If the `\-\-name` parameter is omitted, the command authenticates as the currently logged\-in user via the Himmelblau SSO broker. If the `\-\-name` parameter is provided, the command must be run as `root` to impersonate another user.
.PP
This command must be run from a device that has already been joined to Entra ID.
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-\-schema\-client\-id\fR <SCHEMA_CLIENT_ID>
.HP
\fB\-\-group\-id\fR <GROUP_ID>
.HP
\fB\-\-gid\fR <GID>
.HP
\fB\-h\fR, \fB\-\-help\fR
.IP
Print help (see a summary with '\-h')
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,idmap group-add \/\fR[\fI\,OPTIONS\/\fR] \fI\,--name <ACCOUNT_ID> --gid <GID>\/\fR
.SS DESCRIPTION
Add a static group mapping to the idmap cache. This maps an Entra ID group (by name) to a fixed GID. This can be used to maintain group identity and membership compatibility after moving to Entra ID
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-g\fR, \fB\-\-gid\fR <GID>
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,idmap user-add \/\fR[\fI\,OPTIONS\/\fR] \fI\,--name <ACCOUNT_ID> --uid <UID> --gid <GID>\/\fR
.SS DESCRIPTION
Add a static user mapping to the idmap cache. This maps an Entra ID user (by UPN or SAM\-compatible name) to a fixed UID and primary group GID
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-u\fR, \fB\-\-uid\fR <UID>
.HP
\fB\-g\fR, \fB\-\-gid\fR <GID>
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,status \/\fR[\fI\,OPTIONS\/\fR]
.SS DESCRIPTION
Check that the himmelblaud daemon is online and able to connect correctly to the himmelblaud server
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.TP
\fB\-h\fR, \fB\-\-help\fR
Print help
.PP
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.SH SUBCOMMAND
.B aad-tool \fI\,user set-posix-attrs \/\fR[\fI\,OPTIONS\/\fR] \fI\,--schema-client-id <SCHEMA_CLIENT_ID> --user-id <USER_ID>\/\fR
.SS DESCRIPTION
Sets POSIX\-related attributes on a specified Entra ID user object.
.PP
This command updates POSIX attributes (`uidNumber`, `gidNumber`, `unixHomeDirectory`, `loginShell`, and `gecos`) on the Entra ID user identified by `\-\-user\-id`, which must be a valid Object ID or UPN.
.PP
You must also provide the `\-\-schema\-client\-id`, which identifies the application where the extension properties were registered. This value must be the Client ID of the application used for schema registration. The application associated with `\-\-schema\-client\-id` must supply `User.ReadWrite.All` permissions in the tenant.
.PP
If the `\-\-name` parameter is omitted, the command authenticates as the currently logged\-in user via the Himmelblau SSO broker. If the `\-\-name` parameter is provided, the command must be run as `root` to impersonate another user.
.PP
This command must be run from a device that has already been joined to Entra ID.
.SS OPTIONS
.HP
\fB\-d\fR, \fB\-\-debug\fR
.HP
\fB\-D\fR, \fB\-\-name\fR <ACCOUNT_ID>
.HP
\fB\-\-schema\-client\-id\fR <SCHEMA_CLIENT_ID>
.HP
\fB\-\-user\-id\fR <USER_ID>
.HP
\fB\-\-uid\fR <UID>
.HP
\fB\-\-gid\fR <GID>
.HP
\fB\-\-home\fR <HOME>
.HP
\fB\-\-shell\fR <SHELL>
.HP
\fB\-\-gecos\fR <GECOS>
.HP
\fB\-h\fR, \fB\-\-help\fR
.IP
Print help (see a summary with '\-h')
.SH SEE ALSO
.BR himmelblau.conf (5),
.BR himmelblaud (8),
.BR himmelblaud-tasks (8)
.SH AUTHOR
David Mulder <dmulder@himmelblau-idm.org>,
<dmulder@samba.org>
